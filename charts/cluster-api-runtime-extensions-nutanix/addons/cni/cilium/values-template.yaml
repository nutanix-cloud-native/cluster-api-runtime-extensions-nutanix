cni:
  chainingMode: portmap
  exclusive: false
hubble:
  enabled: true
  tls:
    auto:
      enabled: true               # enable automatic TLS certificate generation
      method: cronJob             # auto generate certificates using cronJob method
      certValidityDuration: 60    # certificates validity duration in days (default 2 months)
      schedule: "0 0 1 * *"       # schedule on the 1st day regeneration of each month
  relay:
    enabled: true
    tls:
      server:
        enabled: true
        mtls: true
    image:
      useDigest: false
    priorityClassName: system-cluster-critical
{{- $capiProvider := index .Cluster.Labels "cluster.x-k8s.io/provider" }}
{{- if eq $capiProvider "eks" }}
ipam:
  mode: eni
{{- else }}
ipam:
  mode: kubernetes
{{- end }}
image:
  useDigest: false
operator:
  image:
    useDigest: false
certgen:
  image:
    useDigest: false
socketLB:
  hostNamespaceOnly: true
envoy:
  image:
    useDigest: false

{{- if .EnableKubeProxyReplacement }}
kubeProxyReplacement: true
{{- end }}

{{- if eq $capiProvider "eks" }}
k8sServiceHost: "{{ trimPrefix .Cluster.Spec.ControlPlaneEndpoint.Host "https://" }}"
k8sServicePort: "{{ .Cluster.Spec.ControlPlaneEndpoint.Port }}"
{{- else }}
k8sServiceHost: auto
{{- end }}

{{- if eq $capiProvider "eks" }}
enableIPv4Masquerade: false
eni:
  enabled: true
  awsReleaseExcessIPs: true
routingMode: native
endpointRoutes:
  enabled: true
{{- end }}
